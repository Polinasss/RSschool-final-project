import{a as be}from"./chunk-RIKPSUBX.js";import{a as V,b as X}from"./chunk-KSSA7SCF.js";import{a as Ee}from"./chunk-O4VMZ2NP.js";import"./chunk-WMUHE67Z.js";import{a as pe,c as me}from"./chunk-I6WBTFIN.js";import{a as Ie,b as ye,c as Te,d as Fe,e as Re,f as Me,g as Se}from"./chunk-MU6QX773.js";import{a as xe}from"./chunk-OATETTAM.js";import{a as ve,b as Ce}from"./chunk-VZCW3W3G.js";import"./chunk-KW5VZNQM.js";import{a as P}from"./chunk-SWG7LFT6.js";import"./chunk-EZOB3TJ4.js";import"./chunk-7CFUQ7C3.js";import"./chunk-RGNDWIHZ.js";import{q as _e}from"./chunk-MGBRLVRV.js";import{b as z,d as te,f as U,g as H,i as ue,k as q,l as fe,n as W,p as J,s as K,u as Q}from"./chunk-PDIALKXB.js";import{Z as he,aa as ge}from"./chunk-WBXFGMZG.js";import"./chunk-PMXBU2MZ.js";import{i as de,l as G,m as F,n as ce,o as N,p as le,q as se}from"./chunk-P6FRCD3I.js";import{A as ne,Cc as f,Dc as C,Ec as ee,Gc as ae,Hc as b,Ib as m,Ka as I,Kb as l,La as y,Ub as a,Vb as r,Wb as x,Xb as R,Yb as M,Zb as re,_b as T,a as L,b as Z,dc as v,fc as p,na as oe,ob as c,oc as S,pb as w,pc as s,qc as E,rc as D,ta as u,xc as g,z as A,za as h}from"./chunk-LLXA3JIY.js";var Pe=(()=>{let t=class t{constructor(n,i){this.location=n,this.router=i}createRide(){console.log("create")}goBack(){window.history.length>1?this.location.back():this.router.navigate(["/admin/routes"])}};t.\u0275fac=function(i){return new(i||t)(w(de),w(me))},t.\u0275cmp=h({type:t,selectors:[["app-ride-header"]],inputs:{id:"id"},standalone:!0,features:[g],decls:7,vars:1,consts:[[1,"header"],[1,"header__title"],[1,"header__button"],["aria-hidden","false","aria-label","Go Icon","fontIcon","arrow_back_ios",1,"header__icon",3,"click"],[1,"header__subtitle"],[3,"clickOnButton"]],template:function(i,d){i&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-icon",3),v("click",function(){return d.goBack()}),r()(),a(4,"h2",4),s(5),r()(),a(6,"app-create-button",5),v("clickOnButton",function(){return d.createRide()}),r()()),i&2&&(c(5),D("Route ",d.id,""))},dependencies:[be,P],styles:[".header[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;gap:10px;margin-top:20px}.header__title[_ngcontent-%COMP%]{display:flex;align-items:flex-end}.header__subtitle[_ngcontent-%COMP%]{font-size:24px}.header__button[_ngcontent-%COMP%]{width:30px;height:50px;cursor:pointer}.header__button[_ngcontent-%COMP%]:hover{opacity:.3}"]});let e=t;return e})();var $=(()=>{let t=class t{constructor(){this.store=u(_e),this.ride$=this.store.select(X.selectRide),this.error$=this.store.select(X.selectError),this.isLoading$=this.store.select(X.selectIsLoading)}loadRideById(n){this.store.dispatch(V.loadRideById({id:n}))}addRide(n,i){this.store.dispatch(V.createNewRide({routeId:n,ride:i}))}updateRide(n,i,d,_){this.store.dispatch(V.updateRide({routeId:n,rideId:i,segmentId:d,segment:_}))}deleteRide(n,i){this.store.dispatch(V.deleteRide({routeId:n,rideId:i}))}};t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=oe({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function Ve(e,t){if(e&1&&(a(0,"div",7)(1,"p"),s(2),r(),a(3,"p"),s(4,"-"),r(),x(5,"input",8),r()),e&2){let o=t.$implicit;c(2),E(o),c(3),l("formControlName",o)}}function Be(e,t){if(e&1){let o=T();R(0),a(1,"form",3)(2,"p",4),s(3,"Price"),r(),m(4,Ve,6,2,"div",5),f(5,"async"),r(),a(6,"mat-icon",6),v("click",function(){I(o);let i=p();return y(i.onSavePrice())}),r(),M()}if(e&2){let o=p();c(),l("formGroup",o.priceForm),c(3),l("ngForOf",C(5,2,o.carriageNames$))}}function je(e,t){if(e&1&&(a(0,"div",7)(1,"div",11)(2,"p"),s(3),r(),a(4,"p"),s(5,"-"),r(),a(6,"p"),s(7),f(8,"currency"),r()()()),e&2){let o,n=t.$implicit,i=p(2);c(3),E(n),c(4),E(ae(8,2,(o=i.priceForm.get(n))==null?null:o.value,"USD","symbol","1.0-0"))}}function Le(e,t){if(e&1){let o=T();a(0,"div",9)(1,"p",4),s(2,"Price"),r(),m(3,je,9,7,"div",5),f(4,"async"),r(),a(5,"mat-icon",10),v("click",function(){I(o);let i=p();return y(i.onUpdatePrice(i.i))}),r()}if(e&2){let o=p();c(3),l("ngForOf",C(4,1,o.carriageNames$))}}var Oe=(()=>{let t=class t{constructor(n){this.fb=n,this.editPriceIndex=null,this.carriageFacade=u(Ee),this.carriage$=this.carriageFacade.carriage$}ngOnInit(){this.carriageNames$=this.carriage$.pipe(A(n=>Object.keys(this.price).reduce((i,d)=>{let _=n.find(O=>O.code===d);return _&&i.push(_.name),i},[]).sort())),this.initializeForm()}initializeForm(){let n={};Object.keys(this.price).forEach(i=>{n[i]=new ue(this.getValue(this.price,i))}),this.priceForm=this.fb.group(n)}getValue(n,i){return n[i]}onUpdatePrice(n){this.editPriceIndex=n}onSavePrice(){this.priceForm.valid&&(this.editPriceIndex=null)}};t.\u0275fac=function(i){return new(i||t)(w(K))},t.\u0275cmp=h({type:t,selectors:[["app-ride-price"]],inputs:{price:"price",i:"i",length:"length"},standalone:!0,features:[g],decls:4,vars:2,consts:[["showPrice",""],[1,"schedule__timework"],[4,"ngIf","ngIfElse"],[1,"schedule__time__column",3,"formGroup"],[1,"schedule__subtitle"],["class","schedule__price",4,"ngFor","ngForOf"],["aria-hidden","false","aria-label","Save Icon","fontIcon","save",1,"schedule__icon",3,"click"],[1,"schedule__price"],["type","number",1,"schedule__input",3,"formControlName"],[1,"schedule__time__column"],["aria-hidden","false","aria-label","Edit Icon","fontIcon","edit",1,"schedule__icon",3,"click"],[1,"schedule__form"]],template:function(i,d){if(i&1&&(a(0,"div",1),m(1,Be,7,4,"ng-container",2)(2,Le,6,3,"ng-template",null,0,b),r()),i&2){let _=S(3);c(),l("ngIf",d.editPriceIndex===d.i)("ngIfElse",_)}},dependencies:[F,G,P,se,N,Q,q,z,fe,U,H,W,J],styles:[".schedule__subtitle[_ngcontent-%COMP%]{font-weight:600}.schedule__price[_ngcontent-%COMP%]{display:flex;align-items:center}.schedule__icon[_ngcontent-%COMP%]{margin-top:12px;color:#2169c1;cursor:pointer}.schedule__icon[_ngcontent-%COMP%]:hover{opacity:.3}.schedule__input[_ngcontent-%COMP%]{padding:5px;margin:5px}.schedule__form[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:8px}.schedule__timework[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:10px 20px 10px 10px}"]});let e=t;return e})();function Ae(e,t){e&1&&(a(0,"div"),s(1," Arrival: "),x(2,"input",7),r())}function Ge(e,t){e&1&&(a(0,"div"),s(1," Departure: "),x(2,"input",8),r())}function ze(e,t){if(e&1){let o=T();R(0),a(1,"form",4),m(2,Ae,3,0,"div",5)(3,Ge,3,0,"div",5),r(),a(4,"mat-icon",6),v("click",function(){I(o);let i=p(2);return y(i.onSaveTime())}),r(),M()}if(e&2){let o=p(2);c(),l("formGroup",o.timeForm),c(),l("ngIf",o.i!==0),c(),l("ngIf",o.i!==o.length-1)}}function Ue(e,t){if(e&1&&(a(0,"p"),s(1),f(2,"date"),r()),e&2){let o,n=p(3);c(),D(" Arrival: ",ee(2,1,(o=n.timeForm.get("arrivalTime"))==null?null:o.value,"yyyy-MM-dd hh:mm a")," ")}}function He(e,t){if(e&1&&(a(0,"p"),s(1),f(2,"date"),r()),e&2){let o,n=p(3);c(),D(" Departure: ",ee(2,1,(o=n.timeForm.get("departureTime"))==null?null:o.value,"yyyy-MM-dd hh:mm a")," ")}}function qe(e,t){if(e&1){let o=T();a(0,"div",9),m(1,Ue,3,4,"p",5)(2,He,3,4,"p",5),r(),a(3,"mat-icon",10),v("click",function(){I(o);let i=p(2);return y(i.onUpdateTime(i.i))}),r()}if(e&2){let o=p(2);c(),l("ngIf",o.i!==0),c(),l("ngIf",o.i!==o.length-1)}}function We(e,t){if(e&1&&(a(0,"div",2),m(1,ze,5,3,"ng-container",3)(2,qe,4,2,"ng-template",null,0,b),r()),e&2){let o=S(3),n=p();c(),l("ngIf",n.editTimeIndex===n.i)("ngIfElse",o)}}var we=(()=>{let t=class t{constructor(n){this.fb=n,this.editTimeIndex=null,this.rideFacade=u($)}ngOnInit(){this.timeForm=this.fb.group({arrivalTime:[null,te.required],departureTime:[null,te.required]}),this.time&&([this.arrivalTime,this.departureTime]=this.time,this.initializeFormValues(this.arrivalTime,this.departureTime))}initializeFormValues(n,i){this.i!==null&&this.timeForm.patchValue({arrivalTime:this.getTime(n),departureTime:this.getTime(i)})}getTime(n){return n?new Date(n).toISOString().slice(0,16):null}onUpdateTime(n){this.editTimeIndex=n,this.initializeFormValues(this.arrivalTime,this.departureTime)}onSaveTime(){if(this.timeForm.valid){let{arrivalTime:n,departureTime:i}=this.timeForm.value;this.editTimeIndex=null;let d=this.ride.schedule.find(Y=>Y.rideId===this.rideId),_=d?.segments[this.i],O=Z(L({},_),{time:[i,n]}),B=Z(L({},d),{segments:d?.segments.map((Y,Ne)=>Ne===this.i?O:Y)}),j=L({},O);console.log(this.ride,B),this.rideFacade.updateRide(this.ride.id,this.rideId,this.i,j)}}};t.\u0275fac=function(i){return new(i||t)(w(K))},t.\u0275cmp=h({type:t,selectors:[["app-ride-time"]],inputs:{time:"time",i:"i",length:"length",ride:"ride",rideId:"rideId"},standalone:!0,features:[g],decls:1,vars:1,consts:[["showTime",""],["class","schedule",4,"ngIf"],[1,"schedule"],[4,"ngIf","ngIfElse"],[1,"schedule__timeform",3,"formGroup"],[4,"ngIf"],["aria-hidden","false","aria-label","Save Icon","fontIcon","save",1,"schedule__icon",3,"click"],["type","datetime-local","formControlName","arrivalTime",1,"schedule__input"],["type","datetime-local","formControlName","departureTime",1,"schedule__input"],[1,"schedule__time"],["aria-hidden","false","aria-label","Edit Icon","fontIcon","edit",1,"schedule__icon",3,"click"]],template:function(i,d){i&1&&m(0,We,4,2,"div",1),i&2&&l("ngIf",d.time)},dependencies:[P,F,le,Q,q,z,U,H,W,J],styles:[".schedule[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:10px 20px 10px 10px}.schedule__segment[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr)}.schedule__timeform[_ngcontent-%COMP%]{display:flex;flex-direction:column}.schedule__time[_ngcontent-%COMP%], .schedule__time__column[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:10px}.schedule__icon[_ngcontent-%COMP%]{margin-top:12px;color:#2169c1;cursor:pointer}.schedule__icon[_ngcontent-%COMP%]:hover{opacity:.3}"]});let e=t;return e})();function Je(e,t){if(e&1){let o=T();R(0),a(1,"mat-dialog-content"),s(2," Would you like to delete ride? "),r(),a(3,"mat-dialog-actions")(4,"button",3),s(5,"No"),r(),a(6,"button",4),v("click",function(){I(o);let i=p();return y(i.deleteRide())}),s(7,"Ok"),r()(),M()}}function Ke(e,t){e&1&&(a(0,"mat-dialog-content"),s(1," Trip cannot be deleted as it has already started "),r(),a(2,"mat-dialog-actions")(3,"button",5),s(4,"Ok"),r()())}var ie=(()=>{let t=class t{constructor(){this.dialogRef=u(Ie),this.rideFacade=u($),this.data=u(ye)}deleteRide(){let n=Number(this.data.routeId),i=Number(this.data.rideId),{status:d}=this.data;d==="ok"&&this.rideFacade.deleteRide(n,i)}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=h({type:t,selectors:[["app-ride-delete"]],standalone:!0,features:[g],decls:5,vars:2,consts:[["cannotDelete",""],["mat-dialog-title",""],[4,"ngIf","ngIfElse"],["mat-button","","mat-dialog-close",""],["mat-button","","mat-dialog-close","","cdkFocusInitial","",3,"click"],["mat-button","","mat-dialog-close","","cdkFocusInitial",""]],template:function(i,d){if(i&1&&(a(0,"h2",1),s(1,"Delete ride"),r(),m(2,Je,8,0,"ng-container",2)(3,Ke,5,0,"ng-template",null,0,b)),i&2){let _=S(4);c(2),l("ngIf",d.data.status==="ok")("ngIfElse",_)}},dependencies:[Se,Fe,Re,Me,ge,he,F]});let e=t;return e})();function Qe(e,t){e&1&&(a(0,"div",4),s(1," There is no rides for this route "),r())}function Xe(e,t){if(e&1&&(a(0,"div",12)(1,"div",13),s(2),f(3,"async"),r(),x(4,"app-ride-time",14)(5,"app-ride-price",15),r()),e&2){let o,n=t.$implicit,i=t.index,d=p().$implicit,_=p(3);c(2),E((o=C(3,9,_.rideStations$))==null?null:o[i]),c(2),l("time",n.time)("i",i)("length",d.segments.length)("ride",_.ride)("rideId",d.rideId),c(),l("price",n.price)("i",i)("length",d.segments.length)}}function Ye(e,t){if(e&1){let o=T();a(0,"div",6)(1,"div",7)(2,"h3",8),s(3),r(),a(4,"div",9),v("click",function(){let i=I(o).$implicit,d=p(3);return y(d.onDelete("5ms","5ms",i.rideId))}),x(5,"mat-icon",10),r()(),m(6,Xe,6,11,"div",11),r()}if(e&2){let o=t.$implicit;c(3),D("Ride ",o.rideId,""),c(3),l("ngForOf",o.segments)}}function Ze(e,t){if(e&1&&(a(0,"div"),m(1,Ye,7,2,"div",5),r()),e&2){let o=p(2);c(),l("ngForOf",o.ride.schedule)}}function et(e,t){if(e&1&&(a(0,"div",1),m(1,Qe,2,0,"div",2)(2,Ze,2,1,"div",3),r()),e&2){let o=p();c(),l("ngIf",o.ride.schedule.length===0),c(),l("ngIf",o.ride.schedule.length!==0)}}var De=(()=>{let t=class t{constructor(){this.ride=null,this.stationFacade=u(xe),this.stations$=this.stationFacade.station$,this.dialog=u(Te)}ngOnInit(){if(this.ride){let n=[];this.rideStations$=ne([this.stations$]).pipe(A(([i])=>(this.ride?.path.forEach(d=>{let _=i.find(O=>O.id===d);_&&n.push(_?.city)}),n)))}}onDelete(n,i,d){let _=new Date,B=this.ride?.schedule.find(j=>j.rideId===d)?.segments[0].time[0];B&&(new Date(B)>_?this.dialog.open(ie,{width:"300px",enterAnimationDuration:n,exitAnimationDuration:i,data:{status:"ok",routeId:this.ride?.id,rideId:d}}):this.dialog.open(ie,{width:"300px",enterAnimationDuration:n,exitAnimationDuration:i,data:{status:"error",routeId:this.ride?.id,rideId:d}}))}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=h({type:t,selectors:[["app-ride-item"]],inputs:{ride:"ride"},standalone:!0,features:[g],decls:1,vars:1,consts:[["class","ride",4,"ngIf"],[1,"ride"],["class","schedule__norides",4,"ngIf"],[4,"ngIf"],[1,"schedule__norides"],["class","ride__schedule schedule",4,"ngFor","ngForOf"],[1,"ride__schedule","schedule"],[1,"schedule__header"],[1,"schedule__title"],[1,"schedule__button",3,"click"],["aria-hidden","false","aria-label","Delete Icon","fontIcon","delete",1,"schedule__icon"],["class","schedule__segment",4,"ngFor","ngForOf"],[1,"schedule__segment"],[1,"schedule__name"],[3,"time","i","length","ride","rideId"],[3,"price","i","length"]],template:function(i,d){i&1&&m(0,et,3,2,"div",0),i&2&&l("ngIf",d.ride)},dependencies:[G,F,we,Oe,N,P],styles:[".ride[_ngcontent-%COMP%]{display:flex;flex-direction:column}.ride__schedule[_ngcontent-%COMP%]{display:flex;flex-direction:column;border:1px solid #cccccc;border-radius:5px;box-shadow:2px 2px 2px 2px #ccc;margin:10px 30px 20px 0}.schedule__title[_ngcontent-%COMP%]{font-size:18px;font-weight:600}.schedule__subtitle[_ngcontent-%COMP%]{font-weight:600}.schedule__name[_ngcontent-%COMP%]{font-weight:600;padding:10px;background-color:#faf8f0}.schedule__segment[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr)}.schedule__price[_ngcontent-%COMP%]{display:flex}.schedule__icon[_ngcontent-%COMP%]{margin-top:12px;color:#2169c1;cursor:pointer}.schedule__icon[_ngcontent-%COMP%]:hover{opacity:.3}.schedule__form[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.schedule__header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:10px 10px 0;margin-bottom:0;border-bottom:1px solid #cccccc}.schedule__norides[_ngcontent-%COMP%]{font-size:24px;font-weight:600;position:absolute;top:50%;left:60%;transform:translate(-50%,-60%)}"]});let e=t;return e})();function tt(e,t){e&1&&(a(0,"div",5),x(1,"mat-spinner"),r())}function it(e,t){if(e&1&&(a(0,"div",6)(1,"p"),s(2),f(3,"async"),r()()),e&2){let o=p();c(2),E(C(3,1,o.error$))}}function nt(e,t){e&1&&re(0)}function ot(e,t){if(e&1&&(R(0),m(1,nt,1,0,"ng-container",7),M()),e&2){p();let o=S(9);c(),l("ngTemplateOutlet",o)}}function rt(e,t){if(e&1&&(x(0,"app-ride-item",8),f(1,"async")),e&2){let o=p();l("ride",C(1,1,o.ride$))}}var ke=(()=>{let t=class t{constructor(){this.rideFacade=u($),this.ride$=this.rideFacade.ride$,this.isLoading$=this.rideFacade.isLoading$,this.error$=this.rideFacade.error$}ngOnInit(){this.rideFacade.loadRideById(Number(this.id))}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=h({type:t,selectors:[["app-ride-list"]],inputs:{id:"id"},standalone:!0,features:[g],decls:10,vars:11,consts:[["ride",""],[1,"ride"],["class","ride__spinner",4,"ngIf"],["class","ride__error",4,"ngIf"],[4,"ngIf"],[1,"ride__spinner"],[1,"ride__error"],[4,"ngTemplateOutlet"],[3,"ride"]],template:function(i,d){i&1&&(a(0,"div",1),m(1,tt,2,0,"div",2),f(2,"async"),m(3,it,4,3,"div",3),f(4,"async"),m(5,ot,2,1,"ng-container",4),f(6,"async"),f(7,"async"),m(8,rt,2,3,"ng-template",null,0,b),r()),i&2&&(c(),l("ngIf",C(2,3,d.isLoading$)),c(2),l("ngIf",C(4,5,d.error$)),c(2),l("ngIf",!C(6,7,d.isLoading$)&&!C(7,9,d.error$)))},dependencies:[De,F,N,Ce,ve,ce],styles:[".ride__spinner[_ngcontent-%COMP%]{position:absolute;top:50%;left:60%;transform:translate(-50%,-60%)}"]});let e=t;return e})();var fi=(()=>{let t=class t{constructor(){this.id=null,this.route=u(pe)}ngOnInit(){this.route.paramMap.subscribe(n=>{this.id=n.get("id")})}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=h({type:t,selectors:[["app-ride-page"]],standalone:!0,features:[g],decls:2,vars:2,consts:[[3,"id"]],template:function(i,d){i&1&&x(0,"app-ride-header",0)(1,"app-ride-list",0),i&2&&(l("id",d.id),c(),l("id",d.id))},dependencies:[Pe,ke]});let e=t;return e})();export{fi as RidePageComponent};
