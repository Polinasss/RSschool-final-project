import{a as P}from"./chunk-7V2HVGNQ.js";import{a as F}from"./chunk-XIXW3NB4.js";import{c as y,d as O}from"./chunk-I6WBTFIN.js";import{q as I}from"./chunk-MGBRLVRV.js";import{b as k,d as g,f as N,g as R,k as T,n as V,p as z,s as D,u as j}from"./chunk-PDIALKXB.js";import{Z as q,aa as B}from"./chunk-WBXFGMZG.js";import{a as M}from"./chunk-PMXBU2MZ.js";import{k as x,m as w,r as E}from"./chunk-P6FRCD3I.js";import{Ib as d,Kb as l,Ub as n,Vb as r,Wb as c,dc as S,fc as f,i as b,ob as o,pc as a,ta as p,xc as C,za as v,zc as _}from"./chunk-LLXA3JIY.js";function G(){return t=>t.value.trim().length===0?{space:!0}:null}var A=t=>({"form__input--error":t});function U(t,i){t&1&&(n(0,"p",11),a(1,"Required"),r())}function H(t,i){t&1&&(n(0,"p",11),a(1,"Incorrect email"),r())}function $(t,i){t&1&&(n(0,"p",11),a(1,"Incorrect email or password"),r())}function J(t,i){if(t&1&&(n(0,"div"),d(1,U,2,0,"p",10)(2,H,2,0,"p",10)(3,$,2,0,"p",10),r()),t&2){let s=f();o(),l("ngIf",s.email==null?null:s.email.hasError("required")),o(),l("ngIf",s.email==null?null:s.email.hasError("pattern")),o(),l("ngIf",s.email==null?null:s.email.hasError("serverError"))}}function K(t,i){t&1&&(n(0,"p",11),a(1,"Required"),r())}function Q(t,i){t&1&&(n(0,"p",11),a(1,"Incorrect email or password"),r())}function W(t,i){if(t&1&&(n(0,"div"),d(1,K,2,0,"p",10)(2,Q,2,0,"p",10),r()),t&2){let s=f();o(),l("ngIf",s.password==null?null:s.password.hasError("space")),o(),l("ngIf",s.email==null?null:s.email.hasError("serverError"))}}var _e=(()=>{let i=class i{constructor(){this.fb=p(D),this.http=p(M),this.router=p(y),this.subscriptions=new b,this.isSubmitted=!1,this.isSubmitting=!1,this.roleService=p(P),this.store=p(I)}ngOnInit(){this.loginForm=this.fb.nonNullable.group({email:["",[g.required,g.pattern(/^[\w\d_]+@[\w\d_]+.\w{2,7}$/)]],password:["",[G()]]}),this.subscriptions.add(this.email?.valueChanges.subscribe(()=>this.resetServerErrors())),this.subscriptions.add(this.password?.valueChanges.subscribe(()=>this.resetServerErrors()))}get email(){return this.loginForm.get("email")}get password(){return this.loginForm.get("password")}resetServerErrors(){(this.email?.hasError("serverError")||this.password?.hasError("serverError"))&&(this.email?.setErrors(null),this.password?.setErrors(null))}onSubmit(){this.isSubmitted=!0,this.isSubmitting=!0,this.signIn()}signIn(){let{email:u,password:m}=this.loginForm.getRawValue(),e=this.http.post("/api/signin",{email:u,password:m}).subscribe({next:h=>{localStorage.setItem("token",h.token),this.roleService.isAuthorized().subscribe(L=>{this.store.dispatch(F.changeRole({role:L}))}),this.router.navigateByUrl("/")},error:()=>{this.email?.setErrors({serverError:!0}),this.password?.setErrors({serverError:!0}),this.isSubmitting=!1},complete:()=>{this.isSubmitting=!1}});this.subscriptions.add(e)}ngOnDestroy(){this.subscriptions.unsubscribe()}};i.\u0275fac=function(m){return new(m||i)},i.\u0275cmp=v({type:i,selectors:[["app-login"]],standalone:!0,features:[C],decls:17,vars:10,consts:[[1,"login"],[1,"form__title"],[1,"login__form","form",3,"formGroup"],[1,"form__label"],["formControlName","email",1,"form__input",3,"ngClass"],[4,"ngIf"],["formControlName","password",1,"form__input",3,"ngClass"],[1,"form__controls"],["mat-flat-button","",3,"click","disabled"],["routerLink","/signup",1,"form__link"],["class","form__error",4,"ngIf"],[1,"form__error"]],template:function(m,e){m&1&&(n(0,"div",0)(1,"h1",1),a(2,"Sign In"),r(),n(3,"form",2)(4,"p",3),a(5,"Email"),r(),c(6,"input",4),d(7,J,4,3,"div",5),n(8,"p",3),a(9,"Password"),r(),c(10,"input",6),d(11,W,3,2,"div",5),n(12,"div",7)(13,"button",8),S("click",function(){return e.onSubmit()}),a(14," Sign In "),r(),n(15,"a",9),a(16,"Sign Up"),r()()()()),m&2&&(o(3),l("formGroup",e.loginForm),o(3),l("ngClass",_(6,A,e.isSubmitted&&(e.email==null?null:e.email.invalid)&&(e.email==null?null:e.email.touched))),o(),l("ngIf",e.isSubmitted&&(e.email==null?null:e.email.invalid)&&(e.email==null?null:e.email.touched)),o(3),l("ngClass",_(8,A,e.isSubmitted&&(e.email==null?null:e.email.invalid)&&(e.email==null?null:e.email.touched))),o(),l("ngIf",e.isSubmitted&&(e.password==null?null:e.password.invalid)&&(e.password==null?null:e.password.touched)),o(2),l("disabled",e.loginForm.invalid||e.isSubmitting))},dependencies:[O,j,T,k,N,R,V,z,B,q,w,E,x],styles:[".login[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}",".form[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;padding:.9375rem 1.25rem 1.75rem;background-color:#fff;border-radius:5px;box-shadow:2px 2px 2px 1px #828282;width:400px}.form__title[_ngcontent-%COMP%]{font-size:2.5rem;line-height:1.125rem;font-weight:700;margin:2.5rem 0}.form__label[_ngcontent-%COMP%]{margin-left:.625rem;margin-top:1.25rem;font-size:1rem;font-weight:700}.form__field[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.form__input[_ngcontent-%COMP%]{appearance:none;border:none;outline:none;border-bottom:2px solid #2169c1;background:#2169c133;border-radius:2px 2px 0 0;padding:.625rem;margin-bottom:.625rem;color:#2169c1}.form__input--error[_ngcontent-%COMP%]{border-bottom:2px solid #ba1a1a}.form__input[_ngcontent-%COMP%]::placeholder{font-size:12px;color:#828282}.form__input-small[_ngcontent-%COMP%]{width:110px}.form__controls[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;margin-top:20px;gap:8px}.form__link[_ngcontent-%COMP%]{text-decoration:none;color:#2169c1}.form__link[_ngcontent-%COMP%]:hover{color:#000}.form__group[_ngcontent-%COMP%]{width:380px;border-radius:5px;border:1px solid #828282;padding:10px;margin-bottom:20px}.form__tags[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:15px}.form__icon[_ngcontent-%COMP%]{cursor:pointer}.form__error[_ngcontent-%COMP%]{font-size:.75rem;line-height:.75rem;color:#ba1a1a}.form__error-container[_ngcontent-%COMP%]{min-height:20px}@media (max-width: 425px){.form[_ngcontent-%COMP%]{width:300px}}@media (max-width: 320px){.form[_ngcontent-%COMP%]{width:260px}}"]});let t=i;return t})();export{_e as SigninComponent};
